# Rei Config Manager - 项目说明

## 项目概述
Rei Config Manager 是一个基于 Tauri + Next.js 的跨平台配置文件管理工具，专注于为开发者提供统一的配置文件编辑和版本管理体验。

## 核心设计理念

### 1. 文件系统优先
- **不使用数据库**：所有数据存储在本地文件系统中
- **版本历史**：以 JSON 文件形式保存在应用数据目录
- **用户可控**：用户可以自定义每个软件保留的版本数量
- **便携性**：所有数据都是可读的 JSON 文件，易于备份和迁移

### 2. 双模式配置管理

#### 模式一：常用软件配置（已实现）
- 预定义的软件列表（Zsh、Vim、Git、VS Code等）
- 高度定制化的 UI 编辑器
- Schema 驱动的表单字段
- 智能字段类型识别

#### 模式二：项目配置（待实现）
- 动态项目配置文件管理
- 环境变量管理
- .env 文件支持
- 多环境切换

### 3. 版本管理策略
- **自动保存**：每次修改自动创建版本
- **去重机制**：相同内容不会重复保存（基于 checksum）
- **智能清理**：自动清理超过限制的旧版本
- **手动备份保护**：手动创建的备份不会被自动清理

## 技术架构

### 前端架构
- **框架**: Next.js 14 (App Router)
- **状态管理**: Zustand
- **UI 组件**: 自定义组件 + Tailwind CSS
- **编辑器**: Monaco Editor (待集成)
- **表单处理**: React Hook Form + Zod

### 后端架构
- **框架**: Tauri 2.0
- **语言**: Rust
- **存储**: 文件系统（JSON 文件）
- **配置解析**: 支持 JSON、YAML、TOML、INI、XML

## 文件存储结构

```
应用数据目录/
├── versions/                    # 版本历史
│   ├── [software_id]/          
│   │   ├── index.json          # 版本索引（包含 max_versions 设置）
│   │   └── [version_id].json   # 各个版本内容
│   └── ...
├── preferences.json             # 用户偏好设置
└── templates/                   # 自定义模板（待实现）
```

## 关键特性

### 已实现
1. ✅ 软件配置管理（预定义软件列表）
2. ✅ 版本历史管理（文件系统存储）
3. ✅ 配置回滚功能
4. ✅ 多格式配置文件支持
5. ✅ 软件安装状态检测
6. ✅ 用户偏好设置
7. ✅ 可配置的版本保留数量
8. ✅ 自动版本清理

### 待实现
1. ⏳ 配置编辑器页面
2. ⏳ 表单字段组件（颜色选择器、字体选择器等）
3. ⏳ Monaco Editor 集成
4. ⏳ 配置模板系统
5. ⏳ 项目配置管理
6. ⏳ 配置差异对比
7. ⏳ 导入/导出功能
8. ⏳ 配置同步功能

## 开发指南

### 添加新的软件支持
1. 在 `lib/software-definitions.ts` 中添加软件定义
2. 定义配置 schema（sections 和 fields）
3. 指定配置文件路径（支持多平台）
4. 添加默认模板（可选）

### 自定义字段类型
支持的字段类型：
- `string`: 文本输入
- `number`: 数字输入  
- `boolean`: 开关
- `select`: 下拉选择
- `multiselect`: 多选
- `color`: 颜色选择器（待实现）
- `font`: 字体选择器（待实现）
- `keymap`: 键位映射（待实现）
- `path`: 路径选择器（待实现）
- `code`: 代码编辑器（待实现）
- `array`: 数组编辑（待实现）
- `object`: 对象编辑（待实现）

### 版本管理 API

```typescript
// 保存新版本
save_version(software_id, content, note, is_auto_save)

// 获取版本历史
get_version_history(software_id, limit)

// 恢复版本
restore_version(software_id, version_id)

// 设置最大版本数
set_max_versions(software_id, max_versions)
```

## 性能优化

### 实施的优化
1. **增量版本检测**: 使用 checksum 避免重复保存
2. **懒加载**: 按需加载版本内容
3. **内存缓存**: 缓存常用配置
4. **自动清理**: 定期清理过期版本

### 计划的优化
1. 虚拟滚动（版本列表）
2. Web Worker（大文件处理）
3. 索引优化（快速搜索）
4. 压缩存储（减少磁盘占用）

## 安全考虑

1. **路径验证**: 防止路径遍历攻击
2. **内容校验**: checksum 验证文件完整性
3. **敏感信息**: 自动识别并脱敏显示
4. **权限控制**: 仅访问必要的文件路径

## 注意事项

### 已知限制
1. 部分软件的配置路径可能需要管理员权限
2. Windows 平台的某些配置路径尚未完全支持
3. 大型配置文件（>10MB）可能影响性能

### 最佳实践
1. 定期手动备份重要配置
2. 合理设置版本保留数量（建议 10-50）
3. 使用有意义的版本注释
4. 避免在配置中存储敏感信息

## 未来规划

### 短期目标（v0.2）
- 完成配置编辑器界面
- 实现所有表单字段组件
- 集成 Monaco Editor
- 添加配置模板功能

### 中期目标（v0.3）
- 项目配置管理功能
- 配置差异对比
- 导入/导出功能
- 更多软件支持

### 长期目标（v1.0）
- 云同步功能
- 团队协作
- 插件系统
- AI 辅助配置

## 贡献指南

欢迎贡献代码、报告问题或提出建议。请遵循以下原则：

1. 保持代码简洁和可读性
2. 添加适当的注释（仅英文）
3. 遵循现有的代码风格
4. 确保所有测试通过
5. 更新相关文档

## 技术债务

### 需要改进的地方
1. 错误处理需要更加统一
2. 需要添加单元测试
3. 部分组件需要优化性能
4. 需要添加更多的日志记录

### 重构计划
1. 统一 API 响应格式
2. 优化状态管理结构
3. 改进类型定义
4. 提取通用组件

---

*最后更新: 2025-09-03*